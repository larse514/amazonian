--- 
machine: 
  environment:
    ECS_STACK_NAME: amazonian-ecs
    STACK_NAME: amazonian
  services: 
    - docker

dependencies: 
  override: 
    - "aws configure set default.region us-east-1"
    - "aws configure set default.output json"

test: 
  pre: 
    - aws cloudformation validate-template --template-body file://cloudformation/ecs.yml
    - aws cloudformation validate-template --template-body file://cloudformation/hellocontainer.yml
    - aws cloudformation validate-template --template-body file://cloudformation/deploymentbucket.yml
    - sh ./cloudformation/testcloudformation.sh ${ECS_STACK_NAME} ${STACK_NAME}:
       timeout: 1800

  # post: 
  #   - sh ./cloudformation/cleanup.sh ${ECS_STACK_NAME} ${STACK_NAME}

deployment: 
  development: 
    branch: master
    commands: 
      - sh ./cloudformation/createbucket.sh ecs.bucket.template
      - aws s3 cp cloudformation/ecs.yml s3://ecs.bucket.template/ecs/ecs.yml
      - aws s3 cp cloudformation/hellocontainer.yml s3://ecs.bucket.template/ecstenant/hellocontainer.yml
